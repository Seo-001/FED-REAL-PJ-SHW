<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>로그인</title>

    <!-- 스크립트 태그를 사용해서 axios 라이브러리 불러옵니다. -->

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="./JS/jquery-3.6.3.min.js"></script>
    <script src="./JS/jquery-ui.min.js"></script>
    <!-- <script src="https://code.jquery.com/jquery-latest.min.js"></script> -->
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    <script src="./JS/smoothScroll20.js"></script>

    <script>
      Kakao.init('5bc11e136d9aff8a86918035d140a193');
    </script>
    <script>
      $(document).ready(function () {
        const code = location.search.split('?code=')[1];
        if (code !== undefined) {
          requestToken(code)
            .then(({ data }) => {
              console.log('requestToken:', data);
            })
            .catch((err) => {
              console.error('requestToken:', err);
            });
        } //////////////

        function requestToken(code) {
          const JS_APP_KEY = '5bc11e136d9aff8a86918035d140a193';
          const REDIRECT_URI = 'http://192.168.45.169:5500/01_01.수정본_개인프로젝트_서해원/login.html';
          const makeFormData = (params) => {
            const searchParams = new URLSearchParams();
            Object.keys(params).forEach((key) => {
              searchParams.append(key, params[key]);
              console.log('key', key, params[key]);
            });
            console.log('search');
            /*  append
search params에 key-value 쌍으로 항목을 추가합니다.

params.append('tag', "js"); 
params.toString(); // mode=night&page=2&mode=day&tag=js
쿼리에 tag=js 라는 항목이 추가된 것을 확인할 수 있습니다. 만일 같은 key가 여러번 추가되면 append() 메소드는 쿼리에 항목을 여러번 추가합니다.

params.append('tag', "tricks");
params.toString(); // mode=night&page=2&mode=day&tag=js&tag=tricks */
            return searchParams;
          }; /////makeFormData/////////
          //  post axios를 사용하여 요청을 하는 값
          return axios({
            method: 'POST',
            headers: {
              'content-type': 'application/x-www-form-urlencoded;charset=utf-8',
            },
            url: 'https://kauth.kakao.com/oauth/token',
            data: makeFormData({
              grant_type: 'authorization_code',
              client_id: JS_APP_KEY,
              redirect_uri: REDIRECT_URI,
              code,
            }), ///////////
          }); //////axios///////
        } ///requesttoken/////////

        // 아래는 데모를 위한 UI 코드입니다.

        //displayToken();
        // function displayToken() {
        //   var token = getCookie('authorize-access-token');

        //   console.log(token);
        //   if (token) {
        //     Kakao.Auth.setAccessToken(token);
        //     Kakao.Auth.getStatusInfo()
        //       .then(function (res) {
        //         if (res.status === 'connected') {
        //           document.getElementById('token-result').innerText =
        //             'login success, token: ' + Kakao.Auth.getAccessToken();
        //         }
        //       }) //then///////
        //       .catch(function (err) {
        //         Kakao.Auth.setAccessToken(null);
        //       }); ///catch/////
        //   } ///if////////
        // }

        // function getCookie(name) {
        //   var parts = document.cookie.split(name + '=');
        //   if (parts.length === 2) {
        //     return parts[1].split(';')[0];
        //   }
        // } ///////////////

        // function requestUserInfo() {
        //   Kakao.API.request({
        //     url: '/v2/user/me',
        //     data: {
        //       property_keys: 'profile_nickname',
        //     },
        //   })
        //     .then(function (res) {
        //       alert(JSON.stringify(res));
        //     })
        //     .catch(function (err) {
        //       alert('failed to request user information: ' + JSON.stringify(err));
        //     });
        // } ///////////////////
      }); ///ready////////////
    </script>
  </head>
  <body>
    <img src="./img/kakao.png" alt="카카오 로그인 버튼 " />
    <p id="token-result"></p>
    <!-- <button class="api-btn" onclick="requestUserInfo()">사용자 정보 가져오기</button> -->
  </body>
</html>
