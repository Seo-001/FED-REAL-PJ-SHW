<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>로그인</title>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />

    <!-- 스크립트 태그를 사용해서 axios 라이브러리 불러옵니다. -->

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="./JS/jquery-3.6.3.min.js"></script>
    <script src="./JS/jquery-ui.min.js"></script>
    <!-- <script src="https://code.jquery.com/jquery-latest.min.js"></script> -->
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    <script src="./JS/smoothScroll20.js"></script>
    <!-- <script src="./JS/main.js"></script> -->
    <script>
      Kakao.init('5bc11e136d9aff8a86918035d140a193');
    </script>
    <script>
      $(document).ready(function () {
        const code = location.search.split('?code=')[1];
        if (code !== undefined) {
          requestToken(code)
            .then(({ data }) => {
              console.log('requestToken:', data);
            })
            .catch((err) => {
              console.error('requestToken:', err);
            });
        }

        function requestToken(code) {
          const JS_APP_KEY = '5bc11e136d9aff8a86918035d140a193';
          const REDIRECT_URI = 'http://192.168.45.169:5500/01_01.수정본_개인프로젝트_서해원/login.html';
          const makeFormData = (params) => {
            const searchParams = new URLSearchParams();
            Object.keys(params).forEach((key) => {
              searchParams.append(key, params[key]);
            });

            return searchParams;
          }; //////////////

          return axios({
            method: 'POST',
            headers: {
              'content-type': 'application/x-www-form-urlencoded;charset=utf-8',
            },
            url: 'https://kauth.kakao.com/oauth/token',
            data: makeFormData({
              grant_type: 'authorization_code',
              client_id: JS_APP_KEY,
              redirect_uri: REDIRECT_URI,
              code,
            }), ///////////
          }); //////axios///////
        } ///requesttoken/////////

        function requestUserInfo() {
          Kakao.API.request({
            url: '/v2/user/me',
          })
            .then(function (res) {
              alert(JSON.stringify(res));
            })
            .catch(function (err) {
              alert('failed to request user information: ' + JSON.stringify(err));
            });
        }
      }); ///ready////////////
    </script>
  </head>
  <body>
    <img src="./img/kakao.png" alt="카카오 로그인 버튼 " />
    <p id="token-result"></p>
    <button class="api-btn" onclick="loginWithKakao()" style="visibility: hidden">
  </body>
</html>
